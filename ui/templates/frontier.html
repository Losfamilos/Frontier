{% extends "base.html" %}
{% block content %}

<div class="page">
  <div class="page-header">
    <h1>Frontier Watchlist</h1>
    <p class="muted">Board-grade themes with evidence and questions. Data source: <code>/api/frontier/themes</code></p>
  </div>

  <div id="frontier-status" class="card" style="margin:12px 0;">
    Loading frontier briefs…
  </div>

  <div id="frontier-list" class="grid"></div>
</div>

<script>
(async () => {
  const status = document.getElementById("frontier-status");
  const list = document.getElementById("frontier-list");

  function esc(s){ return (s ?? "").toString().replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

  try {
    const url = "/api/frontier/themes?top_n=6&events_per_theme=5";
    const r = await fetch(url, { cache: "no-store" });
    if (!r.ok) throw new Error(`HTTP ${r.status}`);
    const data = await r.json();

    const items = data.items || [];
    status.innerHTML = `<div><b>Loaded</b> ${items.length} frontier briefs.</div>`;

    if (!items.length) {
      list.innerHTML = `<div class="card">No frontier briefs yet. Run: <code>bash scripts/bootstrap.sh</code></div>`;
      return;
    }

    list.innerHTML = items.map(it => {
      const ev = (it.evidence || []).slice(0, 5).map(e => `
        <li>
          <span class="muted">${esc(e.date)} · ${esc(e.source_name)} (tier ${esc(e.source_tier)})</span><br/>
          <a href="${esc(e.url)}" target="_blank" rel="noreferrer">${esc(e.title)}</a>
        </li>
      `).join("");

      return `
        <div class="card">
          <div style="display:flex;justify-content:space-between;gap:12px;align-items:flex-start;">
            <div>
              <div style="font-weight:800;font-size:16px;">${esc(it.theme)}</div>
              <div class="muted">First seen: ${esc(it.first_seen)} · 90d: ${esc(it.count_90d)} · 365d: ${esc(it.count_365d)} · accel: ${esc(it.accel_ratio)}</div>
            </div>
            <div style="font-weight:800;">${esc(it.score)}</div>
          </div>

          <div style="margin-top:10px;">
            <div class="muted"><b>Why now:</b> ${esc(it.why_now)}</div>
            <div style="margin-top:6px;"><b>Board question:</b> ${esc(it.board_question)}</div>
          </div>

          <div style="margin-top:10px;">
            <div class="muted"><b>Channels:</b> ${(it.channels||[]).map(esc).join(", ")}</div>
          </div>

          <div style="margin-top:10px;">
            <b>Evidence</b>
            <ul style="margin-top:6px; padding-left:18px;">${ev}</ul>
          </div>
        </div>
      `;
    }).join("");

  } catch (e) {
    status.innerHTML = `<div class="card"><b>Failed to load frontier</b>: ${esc(e.message)}</div>`;
  }
})();
</script>

{% endblock %}
